@using ASM.Models
@model IEnumerable<dynamic>
@{
    ViewData["Title"] = "Lịch sử đơn hàng";
}

<history-page></history-page>

@section Templates {
    <script type="text/x-template" id="history-template">
        <div class="min-h-screen bg-gray-50 py-12">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Lịch sử đơn hàng</h1>

                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-100 text-gray-600 font-medium">
                            <tr>
                                <th class="px-6 py-4">Mã đơn</th>
                                <th class="px-6 py-4">Ngày đặt</th>
                                <th class="px-6 py-4">Địa chỉ</th>
                                <th class="px-6 py-4">Tổng tiền</th>
                                <th class="px-6 py-4">Trạng thái</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr v-for="order in orders" :key="order.orderId" class="hover:bg-gray-50">
                                <td class="px-6 py-4 font-bold text-orange-600">#{{ order.orderId }}</td>
                                <td class="px-6 py-4">{{ formatDate(order.createdAt) }}</td>
                                <td class="px-6 py-4 max-w-xs truncate">{{ order.fullAddress }}</td>
                                <td class="px-6 py-4 font-bold">{{ formatPrice(order.totalAmount) }}</td>
                                <td class="px-6 py-4">
                                    <span class="px-3 py-1 rounded-full text-xs font-bold uppercase" :class="getStatusClass(order.status)">
                                        {{ getStatusText(order.status) }}
                                    </span>
                                </td>
                            </tr>
                            <tr v-if="orders.length === 0">
                                <td colspan="5" class="px-6 py-12 text-center text-gray-500">Bạn chưa có đơn hàng nào.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </script>
}

@section Scripts {
    <script>
        const serverOrders = @Html.Raw(Json.Serialize(Model));

        if (window.vueApp) {
            window.vueApp.component('history-page', {
                template: '#history-template',
                setup() {
                    const { ref } = Vue;
                    const orders = ref(serverOrders);

                    const formatPrice = (p) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(p);
                    const formatDate = (d) => new Date(d).toLocaleString('vi-VN');

                    const getStatusClass = (s) => {
                        switch(s) {
                            case 'pending': return 'bg-yellow-100 text-yellow-700';
                            case 'delivered': return 'bg-green-100 text-green-700';
                            case 'cancelled': return 'bg-red-100 text-red-700';
                            default: return 'bg-blue-100 text-blue-700';
                        }
                    };

                    const getStatusText = (s) => {
                        const map = { pending: 'Chờ xử lý', confirmed: 'Đã xác nhận', delivering: 'Đang giao', delivered: 'Hoàn tất', cancelled: 'Đã hủy' };
                        return map[s] || s;
                    };

                    return { orders, formatPrice, formatDate, getStatusClass, getStatusText };
                }
            });
        }
    </script>
}
